<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>A4</title>

    <!-- Normalize or reset CSS with your favorite library -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css">

    <!-- Load paper.css for happy printing -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/paper-css/0.4.1/paper.css">

    <!-- Set page size here: A5, A4 or A3 -->
    <!-- Set also "landscape" if you need -->
    <style>@page { size: A4 }</style>


    <style>
        article { margin-top: -2px !important; }
        table { margin-top: -15px !important; }
    </style>
</head>

<!-- Set "A5", "A4" or "A3" for class name -->
<!-- Set also "landscape" if you need -->
<body class="A4" dir="rtl">

<!-- Each sheet element should have the class "sheet" -->
<!-- "padding-**mm" is optional: you can set 10, 15, 20 or 25 -->
<section class="sheet padding-10mm">

    <!-- Write HTML just like a web page -->
    <img src="/images/storeheader.jpg" width="720px;">
    <article style="align-content: center;font-size: 18px;font-weight: bold;text-align: center;">سند ايراد محلي</article>
    <article style="align-content: center;font-size: 18px;font-weight: bold;text-align: center;"> رقم : <h style="color: red !important;font-weight: normal">{{numberFourDigit data.referenceNo}}</h>
        <h style="font-weight: normal;float: left;font-size: 10px;">(1/{{totalPage}})</h></article>
    <article style="font-weight: bold"> <h>تم توريد وإضافة المواد الموضحة ادناه بتاريخ :{{ dateNormal data.date}}</h> <h style="float: left">مستودع :  {{data.warehouse.name}}</h></article><br>
    <article style="font-weight: bold"> <h> من : {{data.supplier.name}}</h> <h style="float: left">العنوان :{{data.supplier.address}}</h></article><br>
    <article style="font-weight: bold"> <h> بموحب الفاتورة رقم : {{data.billNo}}</h>  <h style="margin-right: 50px"> بتاريخ :{{ dateNormal data.LPODate}}</h> <h style="float: left">طبقاً لطلب الشراء رقم :{{data.LPONo}}</h></article><br>

    <table  class="table table-bordered">
        <thead>
        <tr style="height: 10px;">
            <th >م</th>
            <th width="15%">الحرف ولرقم</th>
            <th > النوع</th>
            <th >الوحدة</th>
            <th style="width: 10%">رقماً</th>
            <th style="width: 15%">كتابة</th>

        </tr>
        </thead>
        <tbody>

        {{#each purchaseItems}}

        <!-- check the page is more than ten items -->
        {{#checkRowEight @index}}

        <!-- closing the current page -->
        </tbody>

    </table>



    <article style="position: absolute; bottom: 0;">
        <article style="font-weight: bold"> <h> وردت بواسطة </h> <h style="float: left">يعتمد </h></article><br>

        <article style="font-weight: bold">

            {{#if data.storeSign}}
            <img src="http://srv-trasl/eziflowwebservice/eziflowimageservice.ashx?username={{data.user.userName}}&ActionName=userssignature" height="100px" >

            {{#if data.financeSign}}
            <img style="float: left" src="http://srv-trasl/eziflowwebservice/eziflowimageservice.ashx?username={{financeUserName}}&ActionName=userssignature" height="100px" >
            <img style="float: left" src="/images/finance.png" height="160px" >
            {{else}}
            {{#compare data.financeUserID "===" user.userID}}
            <button style="float: left" name="financeSign" onclick="financeSign()" >التوقيع </button><br><br>
            {{/compare}}
            {{/if}}

            {{else}}
            {{#compare data.userID "===" user.userID}}
            <button name="storeSign" onclick="storeSign()" >التوقيع </button><br><br>
            {{/compare}}
            {{/if}}



        </article>


        <img src="/images/storefooter.jpg" width="720px;" >
    </article>

</section>



</body>

<!-- New Page Start -->


<body class="A4" dir="rtl">

<!-- Each sheet element should have the class "sheet" -->
<!-- "padding-**mm" is optional: you can set 10, 15, 20 or 25 -->
<section class="sheet padding-10mm">

    <!-- Write HTML just like a web page -->
    <img src="/images/storeheader.jpg" width="720px;">
    <article style="align-content: center;font-size: 18px;font-weight: bold;text-align: center;">سند ايراد محلي</article>
    <article style="align-content: center;font-size: 18px;font-weight: bold;text-align: center;"> رقم : <h style="color: red !important;font-weight: normal">{{numberFourDigit ../data.referenceNo}}</h>
        <h style="font-weight: normal;float: left;font-size: 10px;">({{checkPageNumber @index}}/{{../totalPage}})</h></article>
    <article style="font-weight: bold"> <h>تم توريد وإضافة المواد الموضحة ادناه بتاريخ :{{ dateNormal data.date}}</h> <h style="float: left">مستودع :  {{../data.warehouse.name}}</h></article><br>
    <article style="font-weight: bold"> <h> من : {{../data.supplier.name}}</h> <h style="float: left">العنوان :{{../data.supplier.address}}</h></article><br>
    <article style="font-weight: bold"> <h> بموحب الفاتورة رقم : {{../data.LPONo}}</h>  <h style="margin-right: 50px"> بتاريخ :{{ dateNormal data.LPODate}}</h> <h style="float: left">طبقاً لطلب الشراء رقم :{{../data.billNo}}</h></article><br>

    <table  class="table table-bordered">
        <thead>
        <tr >
            <th >م</th>
            <th width="15%">الحرف ولرقم</th>
            <th > النوع</th>
            <th >الوحدة</th>
            <th style="width: 10%">رقماً</th>
            <th style="width: 15%">كتابة</th>

        </tr>
        <tr>



        </tr>
        </thead>
        <tbody>
        {{/checkRowEight}}


        <tr id="MU{{this.itemSl}}">

            <td style="width: 2%;">{{countOne @index}}</td>
            <td> {{this.item.barcode}} </td>
            <td> {{this.item.name}} </td>
            <td style="width: 10%;">{{this.unit.name}}</td>
            <td style="width: 8%;">{{this.quantity}}</td>
            <td style="width: 10%;">{{arabicLetter this.quantity}}</td>
        </tr>
        {{/each}}



        </tbody>


        <tfoot>
        <tr style="font-weight: bold">
            <td colspan="3"></td>
            <td colspan="2">إجمالي</td>
            <td >{{currencyFormat data.totalAmount}}</td>
        </tr>
        </tfoot>



    </table>


    <article style="position: absolute; bottom: 0;">
        <article style="font-weight: bold"> <h> وردت بواسطة </h> <h style="float: left">يعتمد </h></article><br>


        <article style="font-weight: bold">

            {{#if data.storeSign}}
                <img src="http://srv-trasl/eziflowwebservice/eziflowimageservice.ashx?username={{data.user.userName}}&ActionName=userssignature" height="100px" >

                {{#if data.financeSign}}
            <img style="float: left" src="http://srv-trasl/eziflowwebservice/eziflowimageservice.ashx?username={{financeUserName}}&ActionName=userssignature" height="100px" >
            <img style="float: left" src="/images/finance.png" height="160px" >
                {{else}}
                    {{#compare data.financeUserID "===" user.userID}}
                        <button style="float: left" name="financeSign" onclick="financeSign()" >التوقيع </button><br><br>
                    {{/compare}}
                {{/if}}

            {{else}}
                {{#compare data.userID "===" user.userID}}
                    <button name="storeSign" onclick="storeSign()" >التوقيع </button><br><br>
                {{/compare}}
            {{/if}}



            </article>

        <img src="/images/storefooter.jpg" width="720px;" >
    </article>


</section>



</body>

</html>

{{#compare data.attachment '!=' NULL}}
<body class="A4" dir="rtl">

<!-- Each sheet element should have the class "sheet" -->
<!-- "padding-**mm" is optional: you can set 10, 15, 20 or 25 -->
<section class="sheet padding-10mm">

    <!-- Write HTML just like a web page -->
    <img src="/{{data.attachment}}" width="720px;">


</section>

</body>

{{/compare}}





<!-- Modal for add new sup -->
<div id="SPModal" class="modal fade bs-example-modal-lg " tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-lg">
        <div class="modal-content " id="SPModalContent">

            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h5 class="modal-title" >التوقيع
                </h5>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-default">

                        <div class="panel-body">
                            <div class="table-responsive">
                                <div class="form-wrap">
                                    <form name="form one" method="post"  >

                                        <div class="form-group">
                                            <label class="control-label mb-10 text-left">المدير المالي
                                            </label>
                                            <select class="form-control"  name="financeUserID" id="financeUserID" required >
                                                <option value="">يرجى اختيار
                                                </option>

                                                {{#each financeUsers}}
                                                    <option value="{{this.userID}}" >{{this.fullName}}</option>
                                                {{/each}}


                                            </select>

                                        </div>

                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!--End -->
            </div>
            <div class="modal-footer">

                <button type="button" class="btn btn-primary btn-outline btn-icon left-icon" onclick="doStoreSign();">
                    <i class="fa fa-user-plus"></i><span> إضافة التوقيع</span>
                </button>
                (بعد التوقيع لا يمكنك تعديل عملية الشراء
                )

            </div>

        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
{{>footer}}


<script type="text/javascript">
    function storeSign(){
       $('#SPModal').modal('toggle');
    }
    function doStoreSign() {

        let financeUserID = $('#financeUserID').val();
        if(financeUserID == ""){
            alert("Please chose the manager")
        }
        else{
            window.location.replace("/purchase/doSign/{{data.purchaseID}}/"+financeUserID);
        }
    }
    
    function financeSign(){
        if(confirm("هل أنت واثق")){
            window.location.replace("/purchase/doFinanceSign/{{data.purchaseID}}/");
        }
    }
</script>

